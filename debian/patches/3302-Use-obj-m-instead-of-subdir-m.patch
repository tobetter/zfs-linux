Description: Use obj-m instead of subdir-m.
 Do not use subdir-m to visit module Makefile. According to upstream commit
 c07d8d47bca1b325102fa2be3a463075f7b051d9 ("kbuild: show hint if subdir-y/m is
 used to visit module Makefile"), modules are no longer built when this is used,
 and obj-y or obj-m should be used instead. Also, note the need for the trailing
 slash. This will make modules.order be generated correctly again, allowing
 modpost to process zfs modules again.
Author: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
Last-Update: 2019-08-12
Index: zfs-linux-0.8.1/module/Makefile.in
===================================================================
--- zfs-linux-0.8.1.orig/module/Makefile.in
+++ zfs-linux-0.8.1/module/Makefile.in
@@ -1,11 +1,11 @@
-subdir-m += avl
-subdir-m += icp
-subdir-m += lua
-subdir-m += nvpair
-subdir-m += spl
-subdir-m += unicode
-subdir-m += zcommon
-subdir-m += zfs
+obj-y += avl/
+obj-y += icp/
+obj-y += lua/
+obj-y += nvpair/
+obj-y += spl/
+obj-y += unicode/
+obj-y += zcommon/
+obj-y += zfs/
 
 INSTALL_MOD_DIR ?= extra
 
@@ -60,12 +60,12 @@ modules_install:
 modules_uninstall:
 	@# Uninstall the kernel modules
 	kmoddir=$(DESTDIR)$(INSTALL_MOD_PATH)/lib/modules/@LINUX_VERSION@
-	list='$(subdir-m)'; for subdir in $$list; do \
+	list='$(obj-y)'; for subdir in $$list; do \
 		$(RM) -R $$kmoddir/$(INSTALL_MOD_DIR)/$$subdir; \
 	done
 
 distdir:
-	list='$(subdir-m)'; for subdir in $$list; do \
+	list='$(obj-y)'; for subdir in $$list; do \
 		(cd @top_srcdir@/module && find $$subdir -name '*.c' -o -name '*.h' -o -name '*.S' |\
 		xargs cp --parents -t $$distdir); \
 	done
