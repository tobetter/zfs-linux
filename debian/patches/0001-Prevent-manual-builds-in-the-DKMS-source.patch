Index: zfs-linux-0.6.5.3/config/dkms.m4
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ zfs-linux-0.6.5.3/config/dkms.m4	2015-10-27 14:31:25.572597153 -0600
@@ -0,0 +1,14 @@
+dnl #
+dnl # Prevent manual building in DKMS source tree.
+dnl #
+AC_DEFUN([ZFS_AC_DKMS_INHIBIT], [
+	AC_MSG_CHECKING([for dkms.conf file])
+        AS_IF([test -e dkms.conf], [
+		AC_MSG_ERROR([
+	*** ZFS should not be manually built in the DKMS source tree.
+	*** Remove all ZFS packages before compiling the ZoL sources.
+	*** Running "make install" breaks ZFS packages.])
+        ], [
+		AC_MSG_RESULT([not found])
+        ])
+])
Index: zfs-linux-0.6.5.3/config/user.m4
===================================================================
--- zfs-linux-0.6.5.3.orig/config/user.m4	2015-10-27 14:30:49.632596263 -0600
+++ zfs-linux-0.6.5.3/config/user.m4	2015-10-27 14:31:25.572597153 -0600
@@ -2,6 +2,7 @@
 dnl # Default ZFS user configuration
 dnl #
 AC_DEFUN([ZFS_AC_CONFIG_USER], [
+	ZFS_AC_DKMS_INHIBIT
 	ZFS_AC_CONFIG_USER_MOUNT_HELPER
 	ZFS_AC_CONFIG_USER_UDEV
 	ZFS_AC_CONFIG_USER_SYSTEMD
Index: zfs-linux-0.6.5.3/config/zfs-build.m4
===================================================================
--- zfs-linux-0.6.5.3.orig/config/zfs-build.m4	2015-10-27 14:30:49.632596263 -0600
+++ zfs-linux-0.6.5.3/config/zfs-build.m4	2015-10-27 14:31:25.572597153 -0600
@@ -87,10 +87,10 @@
 	ZFS_AC_CONFIG_ALWAYS
 
 	case "$ZFS_CONFIG" in
-		kernel) ZFS_AC_CONFIG_KERNEL ;;
 		user)	ZFS_AC_CONFIG_USER   ;;
-		all)    ZFS_AC_CONFIG_KERNEL
-			ZFS_AC_CONFIG_USER   ;;
+		kernel) ZFS_AC_CONFIG_KERNEL ;;
+		all)    ZFS_AC_CONFIG_USER
+			ZFS_AC_CONFIG_KERNEL ;;
 		srpm)                        ;;
 		*)
 		AC_MSG_RESULT([Error!])
